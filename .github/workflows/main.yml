name: Data Preprocessing dan Analisis Eksperimen MSML

description: |
  Workflow ini digunakan untuk melakukan preprocessing dataset housing, 
  membersihkan data dari missing values, dan melakukan analisis eksploratori serta eksperimen 
  menggunakan Jupyter Notebook.

on:
  push:
    branches:
      - main
    paths:
      - '**.py'
      - '**/*.ipynb'
      - 'MLProject/**'

jobs:
  preprocessing:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Preprocessing Data
        run: |
          python automate_Nama-siswa.py
        env:
          input_file: /mnt/data/HousingData.csv
          output_file: /mnt/data/HousingData_clean.csv
        # Hapus success_message dan failure_message
        # Ganti dengan perintah echo untuk status
        - run: echo "Preprocessing selesai, hasil disimpan di HousingData_clean.csv"
        continue-on-error: true  # Jika terjadi error, tetap lanjutkan

  analysis:
    runs-on: ubuntu-latest
    needs: preprocessing  # Menyatakan bahwa analisis hanya akan dijalankan setelah preprocessing selesai

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Analisis Data di Jupyter Notebook
        run: |
          jupyter nbconvert --to notebook --execute /mnt/data/Eksperimen_MSML.ipynb
        # Hapus success_message dan failure_message
        # Ganti dengan perintah echo untuk status
        - run: echo "Analisis selesai. Hasil telah diperbarui di notebook"
        continue-on-error: true  # Jika terjadi error, tetap lanjutkan

  visualization:
    runs-on: ubuntu-latest
    needs: analysis  # Menyatakan bahwa visualisasi hanya akan dijalankan setelah analisis selesai

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Visualisasi Data
        run: |
          python -c "
          import matplotlib.pyplot as plt
          import seaborn as sns
          df = pd.read_csv('/mnt/data/HousingData_clean.csv')
          sns.pairplot(df)
          plt.show()
          "
        # Hapus success_message dan failure_message
        # Ganti dengan perintah echo untuk status
        - run: echo "Visualisasi selesai, tampilkan grafik"
        continue-on-error: true  # Jika terjadi error, tetap lanjutkan

  save_results:
    runs-on: ubuntu-latest
    needs: visualization  # Menyatakan bahwa penyimpanan hasil hanya akan dijalankan setelah visualisasi selesai

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Penyimpanan Hasil
        run: |
          # Menyimpan hasil analisis atau model ke file output
          cp /mnt/data/Hasil_Analisis.csv /mnt/data/output/
        # Hapus success_message dan failure_message
        # Ganti dengan perintah echo untuk status
        - run: echo "Hasil analisis berhasil disimpan"
        continue-on-error: true  # Jika terjadi error, tetap lanjutkan
