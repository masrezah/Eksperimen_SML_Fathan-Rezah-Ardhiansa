name: Data Preprocessing dan Analisis Eksperimen MSML

description: |
  Workflow ini digunakan untuk melakukan preprocessing dataset housing,
  membersihkan data dari missing values, dan melakukan analisis eksploratori serta eksperimen.

on:
  push:
    branches: ["main"]
    paths:
      - "**/*.py"
      - "**/*.ipynb"
      - "MLProject/**"

jobs:
  preprocessing:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2  # Menggunakan versi stabil

      - name: Set up Python
        uses: actions/setup-python@v2  # Menggunakan versi stabil
        with:
          python-version: "3.8"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Preprocessing Data
        env:
          input_file: /mnt/data/HousingData.csv
          output_file: /mnt/data/HousingData_clean.csv
        run: |
          python automate_Nama-siswa.py

      - name: Echo success message
        run: echo "Preprocessing selesai, hasil disimpan di HousingData_clean.csv"

  analysis:
    runs-on: ubuntu-latest
    needs: preprocessing
    if: ${{ always() }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: "3.8"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install jupyter nbconvert

      - name: Analisis Data di Jupyter Notebook
        run: |
          jupyter nbconvert --to notebook --execute /mnt/data/Eksperimen_MSML.ipynb --output /mnt/data/Eksperimen_MSML.out.ipynb

      - name: Echo success message
        run: echo "Analisis selesai. Hasil telah diperbarui di notebook"

  visualization:
    runs-on: ubuntu-latest
    needs: analysis
    if: ${{ always() }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: "3.8"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pandas matplotlib seaborn

      - name: Visualisasi Data
        run: |
          python - <<'PY'
          import pandas as pd
          import matplotlib.pyplot as plt
          import seaborn as sns
          df = pd.read_csv('/mnt/data/HousingData_clean.csv')
          sns.pairplot(df)
          plt.savefig('pairplot.png')
          PY

      - name: Echo success message
        run: echo "Visualisasi selesai, grafik disimpan sebagai pairplot.png"

  save_results:
    runs-on: ubuntu-latest
    needs: visualization
    if: ${{ always() }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: "3.8"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Penyimpanan Hasil
        run: |
          mkdir -p $GITHUB_WORKSPACE/output
          # Menyimpan hasil analisis atau model ke file output
          cp /mnt/data/Hasil_Analisis.csv $GITHUB_WORKSPACE/output/ || true

      - name: Echo success message
        run: echo "Hasil analisis berhasil disimpan"
